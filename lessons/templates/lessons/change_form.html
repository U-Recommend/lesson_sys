{% extends "admin/change_form.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}{{ block.super }}
<script src="{% url 'admin:jsi18n' %}"></script>
{{ media }}
{% endblock %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'admin/css/forms.css' %}">
<link rel="stylesheet" href="{% static 'js/bootstrap/bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'js/bootstrap-select/bootstrap-select.min.css' %}">
<link rel="stylesheet" href="{% static 'js/codemirror5/lib/codemirror.css' %}">
<link rel="stylesheet" href="{% static 'js/codemirror5/theme/seti.css' %}">
{% endblock %}


{% if not is_popup %}
{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% translate 'Home' %}</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
    &rsaquo; {% if has_view_permission %}<a href="{% url opts|admin_urlname:'changelist' %}">{{
    opts.verbose_name_plural|capfirst }}</a>{% else %}{{ opts.verbose_name_plural|capfirst }}{% endif %}
    &rsaquo; {% if add %}{% blocktranslate with name=opts.verbose_name %}Add {{ name }}{% endblocktranslate %}{% else
    %}{{ original|truncatewords:"18" }}{% endif %}
</div>
{% endblock %}
{% endif %}

{% block content %}
<div id="content-main">

    {% block submit_buttons_bottom %}
    {% submit_row %}
    {% endblock %}

    <p>{{ lesson.lesson_type.name }}</p>
    <H1>{{ lesson.title }}</H1>
    <div>
        {% if lesson.content %}
        {{ lesson.content|safe }}
        {% endif %}

        {% if lesson.url %}
        <!--            <iframe src="{{ lesson.url }}" width="100%" height="800px;" frameborder="0"></iframe>-->
        {% endif %}
    </div>
    <h2>
        课后作业
    </h2>
    {% for h in homework_subjects %}
    <div>
        {{ h.content|safe }}
    </div>
    <div>
        <div class="col-md-6">
            <row>
                <textarea class="form-control" rows="10" id="homework_code">
                    {{ h.default_code }}
                </textarea>
            </row>
            <button class="btn btn-primary btn-small">运行</button>
            <button type="button" class="btn btn-small btn-primary" onclick="save_code('{{user.id}}', '{{h.id}}')">
                保存
            </button>
        </div>
        <div class="col-md-6">
            <pre id="code_result" style="height: 300px;"></pre>
        </div>
    </div>
    {% endfor %}


</div>


<script type="text/javascript" src="{% static '/admin/simpleui-x/automatic/dicts.js' %}"></script>
<script type="text/javascript" src="{% static '/admin/simpleui-x/automatic/segment.js' %}"></script>
<script type="text/javascript" src="{% static '/admin/simpleui-x/js/axios.min.js' %}"></script>

<script type="text/javascript" src="{% static '/js/jquery.js' %}"></script>
<script type="text/javascript" src="{% static '/js/moment.min.js' %}"></script>

<script type="text/javascript" src="{% static '/js/bootstrap/bootstrap.min.js' %}"></script>
<script type="text/javascript" src="{% static '/js/layer/2.4/layer.js' %}"></script>
<script type="text/javascript" src="{% static '/js/codemirror5/lib/codemirror.js' %}"></script>
<script type="text/javascript" src="{% static '/js/codemirror5/addon/fold/foldcode.js' %}"></script>
<script type="text/javascript" src="{% static '/js/codemirror5/mode/python/python.js' %}"></script>


<script type="text/javascript">
    var homework_code = document.getElementById("homework_code");

    $(function(){
        $("#changelist-filter").empty();
    })


    var editor = CodeMirror.fromTextArea(homework_code, {
        mode: "text/x-python",
        lineNumbers: true,
        smartIndent: true,
        tabSize: 4,
        theme: 'seti',

    })

    function save_code(uid, sid){
        let code = homework_code.value;
        console.log(code);

        if (code.length==0){
            layer.alert("为空")
            return false
        }
        console.log(uid);
        console.log(sid);
        let data = {
            "code": code,
            "uid": uid,
            "sid": sid
        }
        console.log(data);
        $.post('{% url "homework_code" %}', data, function(res){
            console.log(res);
            layer.msg(res.msg, {time:1000});
        })

    }



</script>

{% endblock %}
